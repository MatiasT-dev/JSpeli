<!DOCTYPE html>
<html>
<head>
    <title>javaSpeli</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <style>
        canvas {
            background: color #eeeeee; ;
            border: 2px solid #d3d3d3;
        }
        button {
            font-size: 30px;
        }


    </style>
    
</head>
  <body style="background-color: black;" onload="aloitapeli()">
   
    <script>

        let piste = 0;
        
        var pelipala;
        var peliesto;
// aloitaa pelin
        function aloitapeli() {
            peliarena.start();
            pelipala = new osansa(30, 30, "white", 10, 120);
            //peli alkaa ja kuutio alkavat levittä 
            peliesto = new osansa(20, 20, "green", Math.floor(Math.random() * 480) + 9, Math.floor(Math.random() * 265) + 9);
            
        }
//pelin areena missä pelaja liikuu
        var peliarena = {
            canvas : document.createElement("canvas"),
            start : function(){

            this.canvas.width = 480;
            this.canvas.height = 270;
            this.context = this.canvas.getContext("2d");
            document.body.insertBefore(this.canvas, document.body.childNodes[0]);
            this.interval = setInterval(paivitapelia, 20);
            window.addEventListener('keydown', function (e) {
                peliarena.key = e.keyCode;
            })
            window.addEventListener('keyup', function (e) {
                peliarena.key = false;
            })
        },
        clear : function() {
            this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
        } 
    }

    
//osat ja tasot
    function osansa(width, height, color, x, y) {
        this.width = width;
        this.height = height;
        this.nopeusX = 0;
        this.nopeusY = 0;  
        this.x = x;
        this.y = y;
        this.updaid = function() {
          ctx = peliarena.context;
         ctx.fillStyle = color;
         ctx.fillRect(this.x, this.y, this.width, this.height);
        }
        this.newpai = function(){
            this.x += this.nopeusX;
            this.y += this.nopeusY;
        }
        //pelajan ja kuution törmäksen havaintoi koodi
        this.osu = function(toinenta) {
            var munvase = this.x;
            var munoike = this.x + (this.width);
            var munylos = this.y;
            var munalas = this.y + (this.height);
            var senvase = toinenta.x;
            var senoike = toinenta.x + (toinenta.width);
            var senylos = toinenta.y;
            var senalas = toinenta.y + (toinenta.height);
            var osunut = true;
            if ((munalas < senylos) ||
               (munylos > senalas) ||
               (munoike < senvase)||
               (munvase > senoike)) { 
                osunut = false;
            }
            return osunut;
        }
    }
//pelin, pelajan ja kuution päivitäminen
    function paivitapelia() {
        //kun pelaja kostkee kuution niin kuutio vaihtaa paikaa ja pelaja saa pisteen
        if (pelipala.osu(peliesto)){
           lisaapiste();
            
            peliesto = new osansa(20, 20, "green", Math.floor(Math.random() * 480) + 9, Math.floor(Math.random() * 265) + 9);
        }

        
        peliarena.clear();
        // liikuminen nuoli laskimilla
        pelipala.nopeusX = 0;
        pelipala.nopeusY = 0;
        if (peliarena.key && peliarena.key == 37) {pelipala.nopeusX = -2; }
        if (peliarena.key && peliarena.key == 39) {pelipala.nopeusX = 2; }
        if (peliarena.key && peliarena.key == 38) {pelipala.nopeusY = -2; }
        if (peliarena.key && peliarena.key == 40) {pelipala.nopeusY = 2; }
        //pelajan ja kuution päivitys
        peliesto.updaid();
        pelipala.newpai();
        pelipala.updaid();
    }
        //pisten päivityksen
        function paivitapiste() {
            document.getElementById("piste").innerHTML = piste;
        }
        //lisää pisteitä
        function lisaapiste() {
            piste++;
            paivitapiste();
        }
        //pisteen vähetäminen
        function pienenapiste() {
            piste--;
            paivitapiste();
        }
        //pisteiden aloitaa alusta
        function resepiste() {
        piste = 0;
        paivitapiste();
        }
        //pisteiden talentamiseen
        function talepistee() {
            localStorage.setItem("piste", piste);
        }
        //pisteiden uudelen ladatumiseen viimeksi talentuksesta
        function uudelenpistee() {
            let tale = localStorage.getItem("piste");
            if (tale !== null) {
                piste = Number(tale);
            }
            paivitapiste();
        }

            
        
        

    </script>
    <!--pisteen laskuri ja debug testi-->
      <p id="piste" style="font-size:40px; color: white;">0</p>
    <nav>
      <button onclick="talepistee()">save</button>
       <button onclick="uudelenpistee()">load</button>
        <button onclick="resepiste()">reset</button>
      </nav>
  </body>
</html>
